# コスト最適化 (Cost Optimization)

## 柱の概要

コスト最適化の柱は、ワークロードのライフサイクル全体を通じてコスト効率を継続的に改善し、最も低いコストでビジネス価値を提供するシステムを構築・運用する能力を扱う。
クラウドでは従量課金モデルにより、実際に使用したリソースに対してのみ支払いが発生する。
この特性を最大限に活用し、不要なコストを排除しながらビジネス成果を最大化することがコスト最適化の目的である。
コスト最適化はセキュリティや信頼性とのトレードオフとして扱うべきではなく、それらを維持した上で実現すべきものである。

## 設計原則

コスト最適化の柱には以下の 5 つの設計原則がある。

- **クラウド財務管理を実装する**: クラウドにおける財務管理の成功とビジネス価値の実現を加速するために、クラウド財務管理（Cloud Financial Management）への投資が必要である。セキュリティや運用と同様に、知識の構築、プログラム、リソース、プロセスを通じてコスト効率の高い組織を構築する。
- **消費モデルを導入する**: 使用したコンピューティングリソースに対してのみ支払い、ビジネス要件に応じて使用量を増減させる。例えば、開発・テスト環境は営業時間帯のみ稼働させることで、最大 75% のコスト削減が可能である（週 40 時間 vs 168 時間）。
- **全体的な効率を測定する**: ワークロードのビジネス上の成果とその提供に関連するコストを測定する。このデータを活用して、アウトプットの増加や機能の拡張、コスト削減による効果を把握する。
- **差別化につながらない高負荷の作業に費用をかけるのをやめる**: AWS がデータセンター運用のような差別化につながらない作業を代行する。マネージドサービスを活用し、OS やアプリケーションの運用負荷を軽減することで、顧客やビジネスプロジェクトに集中できる。
- **費用を分析し帰属関係を明らかにする**: クラウドではワークロードのコストと使用量を正確に特定できるため、IT コストを収益ストリームや個々のワークロードオーナーに透明性をもって帰属させることが可能になる。これにより ROI を測定し、リソースの最適化とコスト削減の機会を見出せる。

## チェックポイント

### COST-1: クラウド財務管理の実践

クラウド財務管理（FinOps）の体制を構築し、組織全体でコスト意識を醸成しているかを確認する。

- コスト管理の責任者（FinOps チーム、クラウド CoE 等）が明確に定義されているか
- コストの可視化・レポーティングの仕組みが整備されているか
- コスト最適化の KPI が定義され、定期的に追跡されているか
- 経営層への定期的なコストレポートが実施されているか
- チーム間でコスト意識を共有する文化が醸成されているか

### COST-2: 使用状況のガバナンス

AWS リソースの利用に対するガバナンスが確立されているかを確認する。

- AWS Organizations と Service Control Policies (SCP) で利用可能なサービス・リージョンを制限しているか
- IAM ポリシーでリソース作成権限が適切に制御されているか
- AWS Budgets でアカウント・サービス単位の予算が設定されているか
- 予算超過時のアラート通知先とエスカレーションパスが定義されているか
- 新規リソースの作成に承認プロセスがあるか

### COST-3: コストと使用状況のモニタリング

コストの可視化と異常検知の仕組みが整備されているかを確認する。

- AWS Cost Explorer が有効化され、定期的にコスト傾向を分析しているか
- AWS Cost and Usage Report (CUR) を出力し、詳細なコスト分析が可能か
- AWS Cost Anomaly Detection でコストの異常を自動検知しているか
- コスト配分タグが全リソースに適用され、プロジェクト・環境・チーム別のコスト追跡が可能か
- タグ付けポリシーが定義され、AWS Config ルールやタグポリシーで強制されているか

### COST-4: 不要リソースの廃止

使用されていないリソースの特定と廃止の仕組みがあるかを確認する。

- 未使用の EC2 インスタンス、EBS ボリューム、Elastic IP を定期的に棚卸ししているか
- 不要な AMI、スナップショット、ログデータの削除ルールが定義されているか
- リソースのライフサイクルポリシーが設定されているか
- AWS Trusted Advisor のコスト最適化チェックを定期的に確認しているか

### COST-5: サービス選定時のコスト評価

サービス選定においてコスト効率が考慮されているかを確認する。

- ワークロードの特性に合ったサービスを選定しているか（EC2 vs Lambda vs ECS 等）
- マネージドサービスの活用により運用コストの削減を検討しているか
- サーバーレスアーキテクチャの採用可否を評価しているか
- ライセンスコスト（BYOL vs ライセンス込み）を比較検討しているか

### COST-6: リソースのライトサイジング

リソースのタイプ・サイズ・数量がコスト目標を満たしているかを確認する。

- AWS Compute Optimizer の推奨に基づいてインスタンスサイズを選定しているか
- CloudWatch メトリクス（CPU 使用率、メモリ使用率等）に基づいてリソースの過剰プロビジョニングを検出しているか
- Graviton インスタンスへの移行を検討しているか（最大 40% のコスト削減が期待できる）
- データベースのインスタンスクラスが実際のワークロードに適合しているか
- S3 ストレージクラス（Standard、Intelligent-Tiering、Glacier 等）がアクセスパターンに最適化されているか

### COST-7: 料金モデルの活用

AWS の料金モデルを活用してコストを削減しているかを確認する。

- Reserved Instances または Savings Plans を利用して定常ワークロードのコストを削減しているか
- Savings Plans のカバレッジと使用率を定期的に確認しているか
- Spot Instances を中断耐性のあるワークロード（バッチ処理、CI/CD 等）に活用しているか
- EC2 Spot と On-Demand の適切な組み合わせを検討しているか
- 無料利用枠の活用状況を把握しているか

### COST-8: データ転送コストの計画

データ転送に関するコストが把握・最適化されているかを確認する。

- リージョン間・AZ 間のデータ転送量とコストを把握しているか
- VPC エンドポイント（Gateway/Interface）を使用して NAT Gateway 経由のデータ転送コストを削減しているか
- CloudFront を活用してオリジンからのデータ転送コストを削減しているか
- 不要なクロスリージョンレプリケーションがないか

### COST-9: 需要管理とリソース供給の調整

需要の変動に応じてリソースを動的に調整する仕組みがあるかを確認する。

- Auto Scaling が適切に設定され、需要に応じたスケーリングが実現されているか
- スケジュールスケーリングを使用して予測可能な需要パターンに対応しているか
- 開発・ステージング環境の営業時間外停止が実装されているか
- サーバーレスサービス（Lambda、Fargate、DynamoDB オンデマンド等）で自動的な需要追従を実現しているか
- スロットリングやキューイングによる需要の平準化が検討されているか

### COST-10: 新サービスの評価

AWS の新サービスや新機能を定期的に評価し、コスト最適化の機会を見出しているかを確認する。

- AWS の新サービスリリースを定期的にチェックしているか
- 既存のアーキテクチャを新しいサービスで置き換えることでコスト削減できないか定期的に評価しているか
- AWS Trusted Advisor や Compute Optimizer の推奨事項を定期的に確認しているか

### COST-11: 労力のコスト評価

運用労力を含めた総合的なコスト評価を行っているかを確認する。

- マネージドサービスと自己管理型サービスの TCO を比較しているか
- 運用自動化による人的コストの削減を考慮しているか
- サードパーティツールのライセンスコストと AWS ネイティブサービスのコストを比較しているか

## リポジトリとの対応関係

本リポジトリの以下のドキュメントがコスト最適化の柱に関連する。

| ドキュメント | 関連する領域 |
|---|---|
| `survey/doc_source/non-functional-requirement.md`（コストセクション） | 予算設定、コスト内訳の詳細度、コストバランスの定義、<br />収益インジケーター、コスト見直しスケジュール、<br />アカウント分割、データ保持期間、リソース需要予測 |
| `design/doc_source/cloud-design-monitoring.md` | CloudWatch によるリソース使用率モニタリング、<br />コスト関連メトリクスの監視設計 |

## よくある指摘事項

レビューで頻繁に検出されるコスト最適化に関するアンチパターンを以下に示す。

- **コスト配分タグが未設定**: タグが付与されていないリソースが多数存在し、プロジェクト別・環境別のコスト追跡ができていない。AWS Organizations のタグポリシーや AWS Config ルールでタグ付けを強制すべきである。
- **開発環境が 24 時間稼働**: 開発・ステージング環境が営業時間外も稼働しており、不要なコストが発生している。AWS Instance Scheduler や EventBridge + Lambda で自動停止・起動を実装すべきである。
- **Reserved Instances / Savings Plans 未検討**: 定常的に稼働するワークロードに対して On-Demand 料金のまま運用しており、最大 72% の割引機会を逃している。
- **不要なリソースが放置されている**: 未アタッチの EBS ボリューム、未使用の Elastic IP、古い AMI・スナップショットが放置されコストが発生している。
- **Cost Explorer / Budgets 未設定**: コストの可視化と予算管理が行われておらず、コスト超過に気付くのが請求書発行後になっている。
- **定期的なコストレビュー未実施**: コスト最適化は一度行えば終わりではなく、月次や四半期ごとのレビューサイクルを確立すべきである。
- **データ転送コストが未考慮**: AZ 間・リージョン間・インターネット向けのデータ転送コストが設計段階で考慮されておらず、想定外のコストが発生している。
- **ライトサイジングが未実施**: Compute Optimizer の推奨を確認せず、初期構築時のインスタンスサイズのまま運用が続いている。
- **S3 ストレージクラスが未最適化**: すべてのオブジェクトが S3 Standard に保存されており、アクセス頻度に応じた Intelligent-Tiering や Glacier への移行が検討されていない。
