# セキュリティの柱

## 柱の概要

セキュリティの柱は、データ・システム・資産を保護しながらクラウドテクノロジーを活用してセキュリティ体制を強化する能力を指す。
AWS Well-Architected フレームワークにおけるセキュリティとは、リスク評価とリスク軽減の戦略を通じてビジネス価値を提供しつつ、情報・システム・資産を保護することである。
AWS の責任共有モデルに基づき、AWS がクラウド「の」セキュリティを担当し、利用者がクラウド「における」セキュリティを担当する。
セキュリティはワークロードの設計・構築・運用・継続的改善のライフサイクル全体を通じて適用する必要がある。
ガバナンスモデルを確立し、個人の判断に依存せず一貫した意思決定を行う仕組みを構築することが重要である。
セキュリティのベストプラクティス領域は、セキュリティの基盤、アイデンティティとアクセス管理、検出、インフラストラクチャ保護、データ保護、インシデント対応、アプリケーションセキュリティの 7 つに分類される。

## 設計原則

1. **強力なアイデンティティ基盤の実装** -- 最小権限の原則を適用し、AWS リソースへの各操作に対して適切な認可を行い、職務分掌を実施する。アイデンティティ管理を一元化し、長期的な静的認証情報への依存を排除する。
2. **トレーサビリティの実現** -- 環境に対するアクションや変更をリアルタイムで監視・アラート・監査する。ログとメトリクスの収集をシステムに統合し、自動的に調査・対応を行う。
3. **全レイヤーへのセキュリティ適用** -- 多層防御アプローチで複数のセキュリティコントロールを適用する。ネットワークエッジ、VPC、ロードバランサー、インスタンス、OS、アプリケーション、コードなど全レイヤーに適用する。
4. **セキュリティのベストプラクティスの自動化** -- ソフトウェアベースの自動セキュリティメカニズムにより、安全なスケーリングを迅速かつ費用対効果の高い方法で実現する。バージョン管理されたテンプレートでコードとして定義・管理されるコントロールを含むセキュアなアーキテクチャを構築する。
5. **転送中および保管中のデータの保護** -- データを機密レベルに分類し、暗号化、トークナイゼーション、アクセスコントロールなどのメカニズムを適切に使用する。
6. **データに人の手を触れさせない** -- データへの直接アクセスや手動処理の必要性を低減・排除するメカニズムとツールを使用する。これにより機密データの誤操作・改変・ヒューマンエラーのリスクを軽減する。
7. **セキュリティイベントへの備え** -- 組織の要件に適合するインシデント管理・調査のポリシーとプロセスを整備する。インシデント対応シミュレーションを実施し、自動化ツールで検出・調査・復旧の速度を向上させる。

## チェックポイント

### SEC-1: セキュリティの基盤（ガバナンスとアカウント管理）

- AWS Organizations を使用してマルチアカウント戦略を実装し、ワークロードを分離しているか。
- AWS Control Tower を導入してランディングゾーンを構築し、ガードレールを設定しているか。
- ルートユーザーにハードウェア MFA を設定し、日常業務では使用を禁止しているか。
- ルートユーザーのアクセスキーを削除し、ルートユーザーの使用をアラートで監視しているか。
- サービスコントロールポリシー（SCP）で組織全体のセキュリティベースラインを強制しているか。
- セキュリティコントロールの目標を特定し、定期的に検証しているか。
- 脅威モデルを作成し、リスクの優先順位付けと軽減策の検討を行っているか。
- セキュリティコントロールのデプロイを自動化しているか。
- セキュリティ管理のスコープを縮小するために共有コンポーネントやマネージドサービスを活用しているか。
- 新しいセキュリティサービスや機能を定期的に評価し、導入を検討しているか。

### SEC-2: アイデンティティとアクセス管理

- AWS IAM Identity Center（旧 SSO）を使用して人間のアクセスを一元管理しているか。
- IAM ユーザーではなくフェデレーション認証を使用し、一時的な認証情報を利用しているか。
- 最小権限の原則に基づき、IAM ポリシーを設計しているか。
- IAM Access Analyzer を使用してポリシーの妥当性を検証しているか。
- MFA をすべての人間のアクセスに対して有効化しているか。
- アクセスキーは可能な限り使用せず、必要な場合は定期的にローテーションしているか。
- IAM ロールを使用したクロスアカウントアクセスを実装しているか。
- 権限の境界（Permissions Boundary）を使用して委任管理を安全に行っているか。

### SEC-3: 検出（発見的コントロール）

- AWS CloudTrail を全リージョン・全アカウントで有効化し、管理イベントとデータイベントを記録しているか。
- Amazon GuardDuty を有効化し、脅威検出を自動化しているか。
- AWS Security Hub を有効化し、セキュリティ検出結果を一元的に集約・管理しているか。
- AWS Config を有効化し、リソースの構成変更を継続的に記録・評価しているか。
- VPC Flow Logs を有効化し、ネットワークトラフィックを記録しているか。
- ログを一元的な場所（例: 専用のログアカウントの S3 バケット）に集約しているか。
- セキュリティアラートの相関分析とエンリッチメントを実施しているか。
- 非準拠リソースに対する自動修復を実装しているか。

### SEC-4: インフラストラクチャ保護

- VPC を使用してネットワーク境界を定義し、パブリックサブネットとプライベートサブネットを分離しているか。
- Security Group と Network ACL を使用して最小限のネットワークアクセスのみを許可しているか。
- AWS WAF を使用してウェブアプリケーションを一般的な攻撃から保護しているか。
- AWS Shield Advanced を DDoS 保護が必要なリソースに対して有効化しているか。
- Amazon Inspector を使用して EC2 インスタンスやコンテナイメージの脆弱性を自動スキャンしているか。
- Systems Manager を使用して EC2 インスタンスへの SSH/RDP 直接アクセスを排除しているか。
- VPC エンドポイントを使用して AWS サービスへのプライベート接続を確立しているか。
- AMI やコンテナのベースイメージを標準化・ハードニングしているか。

### SEC-5: データ保護

- データ分類ポリシーを策定し、機密レベルに基づいたデータ管理を行っているか。
- AWS KMS を使用して保管中のデータ（EBS、S3、RDS 等）を暗号化しているか。
- KMS キーポリシーで暗号鍵へのアクセスを適切に制御しているか。
- 転送中のデータを TLS 1.2 以上で暗号化しているか。
- S3 バケットポリシーでパブリックアクセスをブロックし、暗号化を強制しているか。
- Amazon Macie を使用して S3 内の機密データを自動検出・保護しているか。
- AWS Certificate Manager（ACM）を使用して TLS 証明書を管理しているか。
- バックアップデータの暗号化とアクセス制御を実施しているか。

### SEC-6: インシデント対応

- インシデント対応計画（ランブック・プレイブック）を策定しているか。
- セキュリティインシデントの検出・通知・エスカレーションの自動化を実装しているか。
- インシデント対応に必要な IAM ロール・ツール・アクセス権限を事前に準備しているか。
- 定期的にインシデント対応シミュレーション（ゲームデー）を実施しているか。
- フォレンジック調査用の隔離環境と手順を準備しているか。
- インシデント後のレビュー（ポストモーテム）プロセスを確立しているか。
- Amazon Detective を使用してセキュリティ調査を迅速化しているか。
- AWS CloudTrail Lake を使用してセキュリティイベントのクエリと分析を行っているか。

### SEC-7: アプリケーションセキュリティ

- アプリケーション開発者に対してセキュリティトレーニングを実施しているか。
- 設計フェーズで脅威モデリングを実施し、設計上の欠陥を早期に発見しているか。
- CI/CD パイプラインにセキュリティテスト（SAST、DAST）を組み込んでいるか。
- 定期的にペネトレーションテストを実施しているか。
- コードレビューにセキュリティ観点を含めているか。
- パッケージと依存関係の管理を一元化し、脆弱性スキャンを実施しているか。
- ソフトウェアのデプロイを自動化し、人的介入を最小化しているか。
- パイプラインのセキュリティプロパティを定期的に評価しているか。
- セキュリティのオーナーシップをワークロードチームに組み込むプログラムを構築しているか。

## リポジトリとの対応関係

| チェックポイント | 関連するテンプレート |
|---|---|
| SEC-1: セキュリティの基盤 | `cloud-design-awsaccount.md`（アカウント戦略、SCP、Control Tower） |
| SEC-2: アイデンティティとアクセス管理 | `cloud-design-security.md`（IAM 設計、認証・認可方式） |
| SEC-3: 検出 | `cloud-design-log.md`（CloudTrail、VPC Flow Logs、ログ集約）<br />`cloud-design-security.md`（GuardDuty、Security Hub、Config） |
| SEC-4: インフラストラクチャ保護 | `cloud-design-network.md`（VPC、Security Group、NACL、WAF）<br />`cloud-design-patchmanagement.md`（Inspector、脆弱性管理） |
| SEC-5: データ保護 | `cloud-design-security.md`（KMS 暗号化、データ分類） |
| SEC-6: インシデント対応 | `cloud-design-security.md`（インシデント対応手順）<br />`cloud-design-log.md`（フォレンジック用ログ保全） |
| SEC-7: アプリケーションセキュリティ | `cloud-design-security.md`（アプリケーションセキュリティ方針） |

## よくある指摘事項

### 重大度: 高

- **ルートユーザーに MFA が未設定** -- ルートユーザーの不正利用はアカウント全体の侵害につながる。ハードウェア MFA デバイスの設定を最優先で実施する。
- **CloudTrail が全リージョンで有効化されていない** -- 未有効化のリージョンで不正な API コールが行われた場合に検知できない。組織レベルの証跡で全リージョン・全アカウントをカバーする。
- **IAM ユーザーにインラインポリシーを直接アタッチ** -- ポリシー管理が煩雑になり、最小権限の原則の維持が困難になる。IAM グループまたは IAM ロールにマネージドポリシーをアタッチする方式に変更する。
- **セキュリティグループで 0.0.0.0/0 からの SSH/RDP を許可** -- インターネット全体からの管理アクセスが可能となり、ブルートフォース攻撃のリスクが極めて高い。Systems Manager Session Manager の使用を推奨する。
- **保管中のデータが暗号化されていない** -- EBS ボリューム、S3 バケット、RDS インスタンスでデフォルト暗号化を有効化していない。AWS KMS によるサーバーサイド暗号化を全リソースに適用する。
- **S3 バケットのパブリックアクセスがブロックされていない** -- 意図しないデータ公開のリスクがある。アカウントレベルで S3 Block Public Access を有効化する。
- **マルチアカウント戦略が未導入** -- 単一アカウントに全ワークロードが集約されており、障害影響範囲の分離ができていない。AWS Organizations を使用してアカウントを分離する。
- **ルートユーザーのアクセスキーが存在する** -- プログラムによるルートアクセスが可能な状態は最大のリスクである。即座にアクセスキーを削除する。

### 重大度: 中

- **IAM アクセスキーのローテーションが未実施** -- 長期間変更されないアクセスキーは漏洩リスクが高まる。90 日以内のローテーションを実施するか、IAM ロールによる一時的な認証情報に移行する。
- **GuardDuty が有効化されていない** -- 脅威検出の自動化がなく、不正アクセスの発見が遅れる。全アカウント・全リージョンで GuardDuty を有効化する。
- **Security Hub が有効化されていない** -- セキュリティ検出結果の集約と可視化が行われていない。AWS Foundational Security Best Practices 標準を有効化し、継続的にコンプライアンスを監視する。
- **VPC Flow Logs が有効化されていない** -- ネットワークレベルの異常な通信を検知できない。全 VPC で Flow Logs を有効化し、ログアカウントに集約する。
- **転送中のデータで TLS 1.0/1.1 が許可されている** -- 既知の脆弱性を持つプロトコルが使用可能な状態である。TLS 1.2 以上のみを許可するセキュリティポリシーを適用する。
- **AWS Config が有効化されていない** -- リソースの構成変更が記録されず、コンプライアンス違反を検出できない。Config ルールを使用して継続的な構成評価を実装する。
- **EBS のデフォルト暗号化が有効化されていない** -- 新規作成される EBS ボリュームが暗号化されないリスクがある。リージョンレベルで EBS デフォルト暗号化を有効化する。
- **Network ACL がデフォルトのまま** -- 全トラフィックが許可されており、多層防御が機能していない。必要最小限のルールに制限する。

### 重大度: 低

- **IAM パスワードポリシーが AWS デフォルトのまま** -- パスワードの複雑さや有効期限の要件が不十分な場合がある。組織のセキュリティポリシーに合わせてカスタマイズする。
- **タグ戦略にセキュリティ分類タグが含まれていない** -- データの機密レベルに基づくアクセスコントロールが実装できない。セキュリティ分類タグを標準タグセットに追加する。
- **Secrets Manager や Parameter Store の使用が徹底されていない** -- アプリケーションコードやテンプレートにシークレットがハードコードされるリスクがある。全てのシークレットを Secrets Manager で管理する。
- **セキュリティインシデント対応のシミュレーションが未実施** -- 実際のインシデント発生時に対応の遅延や混乱が生じるリスクがある。定期的なゲームデーを実施して手順を検証する。
- **VPC エンドポイントが未使用** -- AWS サービスへの通信がインターネットゲートウェイを経由しており、データ漏洩のリスクがある。主要サービスに対して VPC エンドポイントを設定する。
- **セキュリティサービスの新機能評価が未実施** -- AWS が継続的にリリースするセキュリティ機能を活用できていない。定期的に新機能を評価し、ワークロードへの適用を検討する。
