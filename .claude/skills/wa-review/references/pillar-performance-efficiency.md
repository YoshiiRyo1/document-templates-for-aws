# パフォーマンス効率の柱

## 1. 柱の概要

パフォーマンス効率の柱は、クラウドリソースを効率的に使用してシステム要件を満たし、需要の変化やテクノロジーの進化に応じてその効率性を維持する能力を対象とする。
オンプレミス環境では、高いパフォーマンスを持続的に達成することが困難であるが、AWS のクラウド環境ではリソースの選択・構成を柔軟に変更できるため、ワークロードに最適なパフォーマンスを継続的に実現できる。
この柱では、アーキテクチャの選択、コンピューティングとハードウェア、データ管理、ネットワークとコンテンツ配信、プロセスと文化の 5 つの重点領域を通じて、パフォーマンス効率の高いクラウドソリューションの構築を支援する。

## 2. 設計原則

パフォーマンス効率の柱には、以下の 5 つの設計原則がある。

### 高度なテクノロジーの民主化 (Democratize advanced technologies)

高度なテクノロジーの実装をチームにとって容易にするため、複雑なタスクをクラウドベンダーに委任する。
NoSQL データベース、メディアトランスコーディング、機械学習などの専門知識を要するテクノロジーを、サービスとして利用することで、チームはリソースのプロビジョニングや管理ではなく、プロダクト開発に集中できる。

### 数分でグローバル展開する (Go global in minutes)

ワークロードを世界中の複数の AWS リージョンにデプロイすることで、最小限のコストで顧客により低いレイテンシーとより良い体験を提供できる。

### サーバーレスアーキテクチャを使用する (Use serverless architectures)

サーバーレスアーキテクチャにより、従来のコンピューティング処理において物理サーバーを実行・管理する必要がなくなる。
マネージドサービスはクラウドスケールで運用されるため、運用上の負担を軽減し、トランザクションコストを削減できる。

### より頻繁に実験する (Experiment more often)

仮想化され自動化可能なリソースを活用し、さまざまなインスタンスタイプ、ストレージ、構成を使用した比較テストを迅速に実施できる。

### メカニカルシンパシーを考慮する (Consider mechanical sympathy)

クラウドサービスの利用方法を理解し、ワークロードの目標に最も適したテクノロジーアプローチを常に選択する。
例えば、データベースやストレージのアプローチを選択する際には、データアクセスパターンを考慮する。

## 3. チェックポイント

### PERF-1: アーキテクチャの選択

**質問: ワークロードに適切なクラウドリソースとアーキテクチャパターンをどのように選択していますか？**

ワークロードに対する最適なソリューションは場合によって異なり、多くの場合、複数のアプローチを組み合わせてパフォーマンスを向上させる。

確認事項:
- ワークロードの特性（コンピューティング集約型、メモリ集約型、I/O 集約型など）を分析しているか
- AWS のマネージドサービス（Amazon DynamoDB、Amazon Aurora Serverless、AWS Lambda など）の活用を検討しているか
- ベンチマークやプロトタイピングにより複数のアーキテクチャパターンを比較評価しているか
- ワークロードの要件変化に応じてアーキテクチャを継続的に見直す仕組みがあるか

### PERF-2: コンピューティングの選択

**質問: ワークロードでコンピューティングリソースをどのように選択・使用していますか？**

AWS ではコンピューティングはインスタンス、コンテナ、関数の 3 つの形態で利用できる。

確認事項:
- EC2 インスタンスファミリー（汎用、コンピューティング最適化、メモリ最適化、ストレージ最適化、高速コンピューティング）を適切に選択しているか
- Graviton プロセッサ搭載インスタンスの採用を検討しているか（コストパフォーマンス向上）
- コンテナ化されたワークロードに対して ECS/EKS および Fargate を検討しているか
- イベント駆動型処理に対して AWS Lambda を検討しているか
- Auto Scaling を適切に構成し、需要の変動に自動対応しているか
- Spot Instances を活用してコスト効率の高いコンピューティングを実現しているか

### PERF-3: ストレージの選択

**質問: ワークロードでデータをどのように保存・管理・アクセスしていますか？**

AWS ではストレージはオブジェクト、ブロック、ファイルの 3 つの形態で利用でき、ワークロードの特性に応じた最適な選択が必要である。

確認事項:
- EBS ボリュームタイプ（gp3、io2、st1、sc1）をワークロードの IOPS/スループット要件に基づいて選択しているか
- Amazon S3 のストレージクラス（Standard、Intelligent-Tiering、Glacier など）をアクセスパターンに基づいて適切に使い分けているか
- Amazon EFS / Amazon FSx をファイル共有が必要なワークロードで検討しているか
- S3 Transfer Acceleration や S3 マルチパートアップロードを大容量データ転送に活用しているか
- データのライフサイクルポリシーを設定し、自動的にストレージクラスを移行しているか

### PERF-4: データベースの選択

**質問: データベースをどのように選択・最適化していますか？**

用途に特化したデータベース（Purpose-built databases）を活用し、ワークロードに最適なデータ管理を実現する。

確認事項:
- リレーショナルデータベース（Amazon RDS、Amazon Aurora）とNoSQL データベース（Amazon DynamoDB）をユースケースに応じて使い分けているか
- Amazon Aurora のリードレプリカを読み取り負荷分散に活用しているか
- Amazon ElastiCache（Redis OSS、Memcached）や Amazon DynamoDB Accelerator (DAX) によるキャッシュ戦略を導入しているか
- データベースのパフォーマンスメトリクス（トランザクション数、クエリレスポンスタイム、接続数、キャッシュヒット率など）を監視しているか
- Amazon RDS Proxy を使用してデータベース接続の管理とプーリングを行っているか
- Amazon Redshift や Amazon OpenSearch Service など、分析・検索ワークロードに適したサービスを検討しているか

### PERF-5: ネットワークの選択

**質問: ワークロードでネットワークリソースをどのように選択・構成していますか？**

ネットワークの最適なソリューションは、レイテンシー、スループット要件、ジッター、帯域幅に基づいて選択する。

確認事項:
- Amazon CloudFront を使用して静的・動的コンテンツをエッジロケーションから配信しているか
- AWS Global Accelerator を使用してグローバルなネットワークパフォーマンスを改善しているか
- VPC エンドポイント（Gateway/Interface）を使用して AWS サービスへのプライベート接続を確立しているか
- Elastic Load Balancing（ALB/NLB）を適切に選択し、トラフィックを効率的に分散しているか
- Enhanced Networking やプレイスメントグループを低レイテンシー要件に活用しているか
- Amazon Route 53 のレイテンシーベースルーティングを使用してユーザーを最寄りのエンドポイントに誘導しているか
- AWS Direct Connect を使用してオンプレミスとの安定した専用接続を確立しているか

### PERF-6: レビュープロセス

**質問: ワークロードのパフォーマンス効率を高めるためにどのようなプロセスを使用していますか？**

パフォーマンス効率の文化を醸成するため、Infrastructure as Code、CI/CD パイプライン、定義されたメトリクス、自動パフォーマンステストを導入する。

確認事項:
- 主要パフォーマンス指標（KPI）を技術メトリクスとビジネスメトリクスの両面で定義・監視しているか
- Amazon CloudWatch のメトリクスとアラームを設定してパフォーマンス異常を検知しているか
- 負荷テスト（ベンチマークテスト、ストレステスト）をデプロイプロセスの一部として自動実行しているか
- 本番環境に近い負荷パターンを再現するテストスクリプトを整備しているか
- パフォーマンスメトリクスをチーム全体で可視化し、ビルドバージョンごとの推移を追跡しているか
- 定期的なアーキテクチャレビューを実施し、新しい AWS サービスや機能の採用を検討しているか

## 4. リポジトリとの対応関係

| チェックポイント | 関連テンプレート | 確認内容 |
|---|---|---|
| PERF-1: アーキテクチャの選択 | cloud-design-common.md | 全体アーキテクチャの選定根拠 |
| PERF-2: コンピューティングの選択 | cloud-design-common.md | インスタンスタイプ・コンテナ・Lambda の選定 |
| PERF-3: ストレージの選択 | cloud-design-common.md | EBS/S3/EFS の構成と選定理由 |
| PERF-4: データベースの選択 | cloud-design-common.md | RDS/Aurora/DynamoDB の選定と最適化 |
| PERF-5: ネットワークの選択 | cloud-design-network.md | CloudFront、ELB、VPC エンドポイントの設計 |
| PERF-6: レビュープロセス | cloud-design-monitoring.md | CloudWatch メトリクス・アラームの設計 |

## 5. よくある指摘事項

以下は、Well-Architected レビューにおいてパフォーマンス効率の柱で頻繁に検出されるアンチパターンである。

### コンピューティング関連

- **インスタンスタイプの見直しが行われていない**: 初期構築時のインスタンスタイプを継続使用しており、AWS Compute Optimizer による推奨事項を確認していない。
- **Graviton プロセッサの検討がない**: x86 ベースのインスタンスのみ使用しており、コストパフォーマンスに優れた Graviton インスタンスへの移行を検討していない。
- **Auto Scaling が未構成または不適切**: 固定台数で運用しており、需要変動に対応できていない。スケーリングポリシーのしきい値が適切でない。
- **Lambda の同時実行数やメモリ設定が未最適化**: デフォルト設定のまま運用し、AWS Lambda Power Tuning による最適化を実施していない。

### ストレージ・データベース関連

- **EBS ボリュームタイプが不適切**: gp2 のまま運用しており、gp3 への移行によるコスト削減とパフォーマンス向上を検討していない。
- **キャッシュ戦略が未検討**: データベースへの直接アクセスのみでキャッシュ層（ElastiCache、DAX）を導入しておらず、不要な負荷がデータベースに集中している。
- **データベースのリードレプリカが未活用**: 読み取り負荷が高いにもかかわらず、プライマリインスタンスのみで処理しており、リードレプリカによる負荷分散を行っていない。
- **S3 ストレージクラスの最適化が未実施**: すべてのオブジェクトを S3 Standard に保存しており、Intelligent-Tiering やライフサイクルポリシーを活用していない。

### ネットワーク関連

- **CloudFront を使用せず直接オリジンにアクセスしている**: 静的コンテンツをオリジンサーバーから直接配信しており、エッジキャッシュによるレイテンシー削減を行っていない。
- **VPC エンドポイントが未構成**: S3 や DynamoDB への通信がインターネットゲートウェイ経由であり、VPC エンドポイントによるプライベート接続を活用していない。
- **ELB の選択が不適切**: HTTP/HTTPS ワークロードに NLB を使用している、または TCP ワークロードに ALB を使用しているなど、ロードバランサーの選択がワークロードに適していない。

### プロセス関連

- **負荷テストが未実施**: 本番環境リリース前の負荷テストが行われておらず、ピーク時のパフォーマンス特性が不明である。
- **パフォーマンスメトリクスの監視が不十分**: CloudWatch のデフォルトメトリクスのみ収集しており、アプリケーション固有のカスタムメトリクスやビジネスメトリクスが定義されていない。
- **新しい AWS サービスや機能の定期的な評価が行われていない**: 初期構築時のアーキテクチャを変更せず運用しており、パフォーマンス向上に寄与する新機能の採用を検討していない。
