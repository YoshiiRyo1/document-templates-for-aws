# 可用性
## 要件

## システム重要度
システムごとに重要度を定義して重要度に合わせた可用性実現案を設計する。  

|重要度|目標月間稼働率|
|---|---|
|High|99.95% (停止時間目安：4h 22m)|
|Medium|99.9% (停止時間目安：8h 45m)|
|Low|目標無し(手動リカバリー)|

## 基本稼働時間
本番環境は 24時間稼働とする。  
開発環境はコストを考慮して平日8時～21時の稼働とする。  

## メンテナンススケジュール
システムの安定稼働を目的をしたメンテナンスを実施する。  
メンテナンスと頻度は以下の通り。  

|管理エリア|メンテナンス内容|停止有無|頻度|実行トリガー|
|---|---|---|---|---|
|OS|OS パッチ適用|有り|第3日曜日0時～5時|手動 (パッチ適用作業は自動化する)|
|OS|リブート|有り|パッチ適用と同じタイミング|同上|
|ミドルウェア|MW パッチ適用|有り|第3日曜日0時～5時|手動 (パッチ適用作業は自動化する)|
|ミドルウェア|MW パッチ適用|有り|個別計画のうえ|手動|
|RDS|自動メンテナンスを行う|内容によっては再起動有り|毎週日曜日2時～3時|自動|
|インベントリ|サーバー情報の収集を行う|無し|毎日8時10分|自動|

## 計画停止
メンテナンススケジュールに規定されない特別なメンテナンスを行うためにシステムの計画停止を行う。  
計画停止は、2週間前にユーザーへ停止日時を通知し、その時間帯にシステムを停止する。  

想定される計画停止は以下の通り。  

* AWS の大規模メンテナンスによるシステム停止
* 社会的に影響の大きいセキュリティパッチの適用
* 社内設備の点検によるシステム停止

## データセンターレベルの可用性
AWS は物理的に分離された複数のデータセンターで Availability Zone が構成されている。  
1つのリージョンは複数の Availability Zone で構成されている。  

重要度 High のシステムは Multi-AZ で冗長構成を組む。  
Multi-AZ の効果を最大限に活かすためマネージドサービスを積極的に採用する。  

重要度 Medium 以下のシステムは Single-AZ で可能な限り冗長構成を組む。  
実現性やコストで Multi-AZ でも問題が無い場合は Multi-AZ にすることも検討する。  

## リージョン間の冗長構成
リージョンを跨いだ冗長構成は採用しない。  
リージョン間の冗長構成を行う場合は、コストと成果を十分に見極めること。  

## 冗長構成パターン
### マネージドサービス
AWS が提供しているマネージドサービスを使って冗長構成をする。  
マネージドサービスは Multi-AZ 前提で設計されているので積極的に活用する。  

### EC2 単体
本番環境の EC2 には EC2 Auto Recovery を設定する。  
AWS 側の物理障害発生時に自動的に再起動し、正常な物理サーバーで EC2 を起動させる。  

### ELB による冗長
サーバー/コンテナの上段に ELB を配置する。サーバー/コンテナは Active-Active 構成になる。  
負荷分散の効果も見込む。  
アプリケーションが対応可能な場合はこのパターンを採用する。  

### DNS フェイルオーバーによる冗長
Route 53 のヘルスチェックとエイリアス/非エイリアスレコードを使ってフェイルオーバーを行う。  
ELB が使えない場合に検討する。  

### クラスタソフトによる冗長
AWS に対応しているクラスタソフトを導入し冗長構成をとる。  
アプリケーション要件でクラスタソフトが必要な場合に検討する。  

### コールドスタンバイ
普段は Single-AZ で稼働、AMI を日次で取得しておく。  
Availability Zone が使用不可能になった場合は、別 Zone に手動復旧をする。  
重要度が Medium/Low のシステムはコールドスタンバイを採用する。  

